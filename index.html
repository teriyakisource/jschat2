<!-- 
    
 Copyright (C) 2020 Vassilis Papavassilopoulos and James Ryrie

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
  -->





















<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>jschat2</title>
        <link href="style.css" rel="stylesheet" type="text/css" />
    </head>
    <body>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.16.1/firebase.js"></script>
    <script src="script.js"></script>



<script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-auth.js"></script>

<script>
  
    var firebaseConfig={apiKey:"AIzaSyAtR3O81i3plrah_kHnRPX6t5eXsGpWACI",authDomain:"python-chat-8e24e.firebaseapp.com",databaseURL:"https://python-chat-8e24e.firebaseio.com",projectId:"python-chat-8e24e",storageBucket:"python-chat-8e24e.appspot.com",messagingSenderId:"773716771181",appId:"1:773716771181:web:e9753bbef6a515b5cc9a64",measurementId:"G-ZR2YGGVS9E"};firebase.initializeApp(firebaseConfig),firebase.analytics();


    console.log("yes")

    
    

    </script>

    
    <div id = 'title'>
        <h1 onclick = 'ColorChange()' id = 'title1'>JsChat2</h1>
    </div>
    <div id='login'>
        <input id = 'email' type = 'email' placehoder = 'email'>
        <input id = 'password' type = 'password' placehoder = 'password' onkeydown = "if (event.keyCode == 13) document.getElementById('Log In').click()">
        <button id = 'Log In' onclick= "login()">Log In</button>
        <button onclick= "signUp()">Sign Up</button>
        <button onclick="window.location.href='tos.html';">Terms and Conditions</button>
        <br>By signing up, you agree to our terms and conditions
        
    </div>
    


    <div id="master">

        <div id="main" align = "right">
            <button onclick= "makeRoom()">Make a Room</button>

            <input id = 'room' type = 'password' placeholder = "Room (default: MainRoom)" autocomplete = "off" value="MainRoom">

            <h2 align = "right">People Online</h2>
            <button id = 'signOut' onclick = "signOut()">Sign Out</button>

            <p id = "people", align = "right"></p>
            <div id = 'specialCommands'>
            <button onclick= "usersOfflineSetMASTER()">MasterOverideOffline</button>
            <button onclick= "deleteButton()">Reset Messages</button>
            </div>
            <p id = "nameField"> </p>



        </div>
        <div id="MessageStream">
            <h2>Message Stream:<h2>

        </div>
        <div>
            <p id = "data"></p>
        </div>

        <div id= writemessage z-index = '1'>
            <input type = "text" placeholder = "Message" id = "message" onkeydown = "if (event.keyCode == 13) document.getElementById('on').click()" autocomplete= "off" >
    
        
            <button onclick= "writeMessage(),document.getElementById('message').value = ''" id = "on">Send</button>
        </div>
    </div>

    <script>
    var myVar;getData(),myVar=setInterval(getData,100);var online="";function login(){var e=document.getElementById("email").value,n=document.getElementById("password").value;firebase.auth().signInWithEmailAndPassword(e,n).catch(function(e){e.code,e.message;alert(e.message)})}function signOut(){firebase.auth().signOut().then(function(){console.log("Signed out Successfull")}).catch(function(e){console.log("Signed out Failed");e.code,e.message;alert(e.message)})}function signUp(){email=document.getElementById("email").value;var e=document.getElementById("password").value;email.includes("@latymer-upper.org")?firebase.auth().createUserWithEmailAndPassword(email,e).catch(function(e){e.code,e.message;alert(e.message)}):alert("Not a school email")}usersOnlineRef(),document.getElementById("master").style.display="none",document.getElementById("login").style.display="block",firebase.auth().onAuthStateChanged(function(e){var n;e?(n=e.email,window.username=n,document.getElementById("master").style.display="block",document.getElementById("login").style.display="none",firebase.database().ref("/Users/").once("value",function(e){e.forEach(function(e){var n=e.val();window.use=n}),document.getElementById("specialCommands").style.display="james.ryrie1@gmail.com"==n||"teriyakivass@gmail.com"==n?"block":"none"}),online=window.username+"<br>",b=window.use+online,console.log("le epic"+b.replace("undefined"," ")),c=b.replace("undefined"," "),firebase.database().ref("/Users/").set({User:c})):(document.getElementById("master").style.display="none",document.getElementById("login").style.display="block",firebase.database().ref("/Users/").once("value",function(e){e.forEach(function(e){var n=e.val();window.use=n})}),online=window.username+"<br>",console.log(online),use1=window.use,use=use1.replace(online," "),use2=use.replace("undefined"," "),console.log(use2),firebase.database().ref("/Users/").set({User:use2}))});

    </script>
  </body>
</html>